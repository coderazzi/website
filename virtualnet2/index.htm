<html>
<!-- Creation date: 12/04/2002 -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<title>VirtualNet2: network simulation with CORBA.</title>
<meta name="Description" content="VirtualNet">
<meta name="Keywords" content="CORBA network simulation">
<meta name="Author" content="Luis Pena">
<meta name="Generator" content="AceHTML 4 Pro">
</head>
<body>

<table width="95%" border="0">
    <tr>
      <td width="150" align="left" valign="top" bgcolor="#BBBBFF">
	  	<center><br>
	    <font color="#4444ff"><b>VirtualNet<font color="#ff0000"><font size="+1">2</font></font></b></font></p>		
		<hr size="1" color="#7777FF" width="80%">				
		<br>
    	<p><a href="../index.htm">Home</a></p>
    	<p><a href="../filesplit/index.htm">FileSplit</a></p>
    	<p><a href="../idldepend/index.htm">IDL depend</a></p>
    	<p><a href="../menu/index.htm">Menu Applet</a></p>
    	<p><a href="http://grasia.fdi.ucm.es/sensei">Sensei</a></p>
    	<p><a href="../splitimage/index.htm">SplitImage</a></p>
    	<p><a href="../virtualnet/index.htm">VirtualNet</a></p>
		
		<hr size="1" color="#7777FF" width="60%">		
    	<a href="../humour.htm">humour</a>
		
		<hr size="1" color="#7777FF" width="80%">		
		<a href="mailto:java_lmp@yahoo.co.uk?subject=webpage"><font size="-1">java_lmp@yahoo.co.uk</font></a><br><br>
		<font size="-1"><b><i><font color="#4444ff">Last Updated:<br> 3rd September 2003</font></i></b></font>		
		<hr size="1" color="#7777FF" width="80%">		
	    </center>
	  </td>
		
      <td width="4">
	  </td>

      <td valign="top">
		<hr size="2" color="#663366" width="400">
         <center><font size="+3" color="#663366"><b><i>VirtualNet<font color="#ff0000">2</font></i></b></font></center>
		<hr size="2" color="#663366" width="400">

        <br>
 		 <table width="100%" border="0"> <tr><td valign="top">
     		 <ul type="disc">
              <li><a href="#History">History</a></li>
              <li><a href="#CreateAVirtualNet">Create a virtual net</a></li>
              <li><a href="#UseVirtualNet">Use the virtual net</a></li>
              <li><a href="#ClientProtocol">Client protocol</a></li>
              <li><a href="#VersionAndBugs">Version and bugs</a></li>
              <li><a href="#LicenseAndDownload">License and download</a></li>
              <li><a href="#Example">Example</a></li>
    		 </ul>
		 </td><td >
		 	<img src="icon.gif" border="1" alt="virtualnet screen capture">
		 </td></tr></table>
    		<p>VirtualNet<font color="#ff0000">2</font> is an application that simulates a network on a standalone computer.</p>
			<p>A CORBA application -<i>by introducing <b>one</b> line of code before initializing the ORB</i>- uses automatically
			   the VirtualNet: it is hosted on one of the virtual computers, and its communications with other CORBA objects are
			   only possible as far as there is any valid virtual path to its host.</p> 
			<p> It works with any application CORBA, and with any ORB implementing <i>interceptors</i>. I have succesfully used it with
    		   the Sun ORB included with JDK1.4, Orbacus 4 and Jacorb 1.4. The application is written in Java, but the application
    		   using the virtual net can be written on any language, provided it has a CORBA mapping. 
			 </p>
		<hr size="1" color="#333399">
		<table border="0"><tr><td width="5"></td><td>
		<a name="History"><h2><font color="#333399">History</font></h2></a>
        <p>This application is the evolution of <a href="../virtualnet/index.htm">VirtualNet</a>, an application I designed in 1997 to
		   be able to simulate a network topology on a single computer. Using most of the communication systems, being sockets, JavaRMI,
		   CORBA, etc, allows the testing of the application on just one computer, but this test lacks the problems that happen on
		   real cases on a network, like:
		   <ul compact type="disc">
       			<li>Slower communications: delays</li>
       			<li>Problems on links, giving way to unreachable nodes</li>
     	  </ul></p>
		<p>On the first approach, VirtualNet only worked with JavaRMI, replacing the <b>rmiregistry</b>. It had its own compiler,
		   parallel to the <b>rmic</b> compiler, to create stubs and skeletons that intercepted the communications, and checked
		   when that communication was possible and which delay had it associated. Although the approach was quite transparent,
		   the application still had to change slightly the code, but the main drawback was that JavaRMI applications not using
		   the registry could not take advantage of the application. And I never tried to change the application to simulate
		   the more advanced capabilities included in JavaRMI with Java2.</p><br>
		 <p>VirtualNet<font color="#ff0000">2</font> works only over CORBA, using the <b>interceptors</b>. It has two parts, the
		   server, written in Java, which creates the virtual net. It has a nice graphical interface, lets the user to modify the
		   virtual net on any moment, and listens on a specific port for virtual paths checking. The protocol to check for virtual
		   paths is very simple, easy to implement on any language.</p>
		 <p>The client part is so far written on Java, but I'm now written as well a C++ client. The interesting client is a
		   CORBA interceptor that automatically accesses the VirtualNet to verify wether the target node is reachable or not.
		   If it's not reachable, a CORBA COMM_FAILURE exception is raised, simulating completely the real case behaviour. This
		   checking is done twice: when the remote object is accessed, and when the answer is sent.</p>
		</td></tr></table>
		<hr size="1" color="#333399">
		<table border="0"><tr><td width="5"></td><td>
		<a name="CreateAVirtualNet"><h2><font color="#333399">Create a virtual net</font></h2></a>
		<p>The server program is <i>vnet2.VirtualNet</i>, which can be invoked (attention to the classpath) as: 
		<pre>java vnet2.VirtualNet</pre>
		This application has several command line arguments:</p>
		<pre>Use [-help] [-nograph] [-verbose] [-port=xxx] file</pre>
		The <b>-nograph</b> option is interesting to launch existing virtual nets without a graphical interface.</p>
		<p>To <b>create</b> a virtual net, it is needed to give a port, where it will listen for client requests. At any moment,
		the graphical interface lets the user save or load any other virtual net.</p>
		<p>To create nodes, links, etc, there is currently just one possibility: go to NetLayout->Modify, and introduce an
		   string with the modifications. I have been working on a nice interface to make it easier, but I really find the
		   current input quite flexible. For example, to create a node 'A', a node 'B', and a link '1' between them, the input is:
		   <pre>+A+B+A&lt;1&gt;B</pre>
		</p>
		<p> Following are the sintactic rules:
		<ol compact> 
		<li>A node or a link is specified by a string that contains no spaces or any of the following 
		 	characters: '-', '+', '&lt;', '&gt;', '(', ')','/'</li>
		<li>A node is created by prepending the character '+' to the name of the node. For example: <b>+Machine_1</b></li>
		<li>To remove a node, the same notation as to created is used, but using the character '-'. For example <b>-Machine_1</b></li>
		<li>A node can de activated/deactivated temporary using '+.' or '-.' For example <b>-.Machine_1</b></li>
		<li>A link is created specifying '+', the first node, then a character '&lt;', the link id, again a character '&gt;'
			and then the second node. For example: <b>+Machine_1&lt;link1&gt;Machine_2</b>. To do the link unidirectional,
			use '&lt;' before the second node: <b>+Machine_1&lt;link1&lt;Machine_2</b></li>
		<li>A link is removed specifying '-&lt;' before the node name, like <b>-&lt;link1</b></li>
		<li>A link can de activated/deactivated temporary using '+.' or '-.;. For example <b>-.&lt;link1</b></li>
		<li>delays (in millseconds) can be specified to nodes or links by appending to its name "(delay)", on creation. 
			For example: <b>+Node(100)</b> or <b>+Node&lt;Link(100)&gt;OtherNode</b></li>
		<li>A node delay can be changed using /node(delay), like in <b>/node(100)</b></li>
		<li>A link delay can be changed using /&lt;link(delay), like in <b>/&lt;link(100)</b></li> 
		<li>The delay for every link can be changed using /&lt;(delay), like <b>/&lt;(100)</b></li> 
		<li>Every node delay can be changed using /(delay), like in <b>/(100)</b></li>
		<li>In the previous cases, if the delay is not specified, default values are assumed</li>		
		<p>For example:
		<pre>+ A + B + C + D + E + A&lt;1&gt;B + A&lt;5&gt;D + B&lt;2&gt;C</pre> 
		<pre>+ B&lt;10&gt;E + E&lt;11&gt;D + C&lt;3&gt;D + C&lt;20&lt;E</pre>		
		</p><p>Creates the next layout:</p><img src="createA.gif" border="1" width="300" height="172" alt="original layout">
		<p>It is possible to move around the nodes and the links, to get a clearer picture:</p>
		<img src="createB.gif" border="1" alt="moved layout">
		<p>Using the mouse, it is possible to activate / deactivate or destroy the nodes and links. Following are the used icons:</p>
         <table border="0" align="left" >
             <tr>
               <td><img src="nodeActive.gif" border="0" width="32" height="32" alt=""></td><td>Node active</td>
			   <td width="40"></td>
               <td><img src="nodeDeactivated.gif" border="0" width="32" height="32" alt=""></td><td>Node deactivated</td>
			   <td width="40"></td>
               <td><img src="nodeInUse.gif" border="0" width="32" height="32" alt=""></td><td>Node in use</td>
             </tr>
             <tr>
               <td><img src="linkActive.gif" border="0" width="32" height="32" alt=""></td><td>Link active</td>
			   <td width="40"></td>
               <td><img src="linkDeactivated.gif" border="0" width="32" height="32" alt=""></td><td>Link deactivated</td>
			   <td width="40"></td>
               <td><img src="linkInUse.gif" border="0" width="32" height="32" alt=""></td><td>Link in use</td>
             </tr>
             <tr>
               <td><img src="linkMonoActive.gif" border="0" width="32" height="32" alt=""></td><td>Link mono active</td>
			   <td width="40"></td>
               <td><img src="linkMonoDeactivated.gif" border="0" width="32" height="32" alt=""></td><td>Link mono deactivated</td>
			   <td width="40"></td>
               <td><img src="linkMonoInUse.gif" border="0" width="32" height="32" alt=""></td><td>Link mono in use</td>
             </tr>
         </table>		
		</p>
		</td></tr></table>
		<hr size="1" color="#333399">
		<table border="0"><tr><td width="5"></td><td>
		<a name="UseVirtualNet"><h2><font color="#333399">Use the virtual net</font></h2></a>
		<p>The server program is located in the package <b>vnet2</b>, but not so the client side. There are several reasons
		   for it. The first is that any application can use the virtual net as a client, and the second one, that the
		   client does not have to be written in Java</p>
		<p>Said this, the package <b>vnet2user</b> contains a client that implements the interceptor behaviour for CORBA.</p> 
		<p>On Java, the ORB is usually initialized with:
		<pre>ORB orb = ORB.init(args, props);</pre>
		Where <i>args</i> are the command line arguments and <i>props</i> the list of properties, as a <i>java.util.Properties</i>.
		Before doing this step, it can be written:
		<pre>args=vnet2user.Interceptor.setup(user, args, props);</pre>
		This method installs the interceptor, using some of the arguments. It expects the following arguments:
		<ul compact>
		  <li><b>-virtualHostName</b>: the name of the virtual host where this ORB is to be simulated. It must exist on the
		      virtual net, and it is mandatory.</li>
		  <li><b>-virtualNetHost</b>: the name of the host containing the virtual net. It is the local host by default</li>
		  <li><b>-virtualNetPort</b>: the port where the virtual net is installed. It is mandatory</li>
		</ul> 
		When the interceptor reads the arguments, it returns another list of arguments where the virtualNet arguments are
		excluded. If some of the mandatory parameters is not present, the program is executed without using the virtual net.</p>
		<p>The first argument for <b>setup</b> is an object implementing the interface <i>vnet2user.InterceptorUser</i>, which
		receives any message from the interceptor. It can be null, but in that case any error is dumped on the normal output,
		and the program exited.</p>
		<p>The distribution includes a client/server program, a counter, showing the use of this interceptor.</p>
		<p>Another interceptor for C++ will be included shortly.</p>
		</td></tr></table>
		<hr size="1" color="#333399">
		<table border="0"><tr><td width="5"></td><td>
		<a name="ClientProtocol"><h2><font color="#333399">Client protocol</font></h2></a>
		<p><i>Note that this section is not needed to use the application</i></p>
		<p>The package <i>vnet2user</i> includes as well a program called <i>TestClient</i> that shows the client
		protocol. This program requires a virtual host name, and then verifies wether there is a virtual path to
		any other host.</p>
		<p>The VirtualNet server listens continuosly on a port, where the client can request wether a virtual path
		is possible. This path is calculated every time, applying the delays that have been specified for each node
		and link: this process can be observed on the screen, as the icons change their colour.</p>
		<p>To work, the virtualNet server stablishes a session for each client: 
		<ol>
			<li>It receives the name of the node to host; this node is
				specified as an array of bytes, holding the first byte
				the number of bytes to read. The node name must be in
				UTF-8 format: byte order specified by a mandatory initial byte-order mark.</li>
			<li>A byte is returned. Return value can be 0 to indicate success
				or FF to indicate error. In this case, a return value of
				FF means that the node given is not existing in the current
				netlayout. This is not a real error, further requests are
				still valid.</li>
			<li>After this session is started, each new request must just
				contain the target node, and the return value will indicate
				wether there is a virtual path bertween both nodes or not.</li>
			<li>The format for the request is the same as for the session creation, now
			    including just the target node name (UTF-8...)</li>
			<li>The return value contains 0 if a path exists and FF if not. This specification can 
				change to show some extended information about the error. For example FE could mean 
				that there is no virtual path because the target node does not exist, etc.
				Anycase, a value 0 will always means success and any other
				value is an error flag</li>
		</ol></p>
		</td></tr></table>
		<hr size="1" color="#333399">
		<table border="0"><tr><td width="5"></td><td>
		<a name="VersionAndBugs"><h2><font color="#333399">Version and bugs</font></h2></a>
		<p>Current version is 0.3; it works without problems, although it contains some minor errors that I will solve
		   as soon as possible:
		   <ul>
		    <li>If a node is destroyed, its links are destroyed as well. But if there is a monodirectional link
			    <b>to</b> the node, that link stays, and must be destroyed separately. The server is still able
				to calculate correctly paths, it is only the screen that looks <i>bad</i></li>
			<li>Once a server is shutdown (virtualnet is closed), if a new one is going to be created, the
				applications keeps on asking if the current virtual net (which one?) must be saved.</li>
			<li>It does not update the display on the Swing thread, resulting in refresh problems. This is the
				most awful problem (at least it does not always appear).</li>
			<li>The interceptors does not behave correctly if the VirtualNet server is shutdown.</li>
		   </ul></p>
		   <p>In addition, the C++ interceptor will be included with the next version.</p>
		</td></tr></table>
		<hr size="1" color="#333399">
		<table border="0"><tr><td width="5"></td><td>
		<a name="LicenseAndDownload"><h2><font color="#333399">License and download</font></h2></a>
  		<p>VirtualNet<font color="#ff0000">2</font> is delivered as it, without any responsabilities on the author. 
		It is open source, it can be used or modified without any limitations. If some bug is found or the behaviour is not 
		as expected, please send me a mail 
		(<a href="mailto:java_lmp@yahoo.co.uk?subject=virtualnet2">java_lmp@yahoo.co.uk</a>) and I will
		promptly introduce the modifications. The task is distributed with source, and therefore you can make by your
		own any changes.</p>
		<p>There are three downloadable files (plus another three on the <a href="#Example">example</a> section):
		<ul type="disc">
		    <li>Source code. It includes the packages vnet2, vnet2user, and the <i>counter</i> example.
				To compile, please use the JDK 1.4, with the option -source 1.4. It is in .zip format (57 KB): <a href="vnet2.zip">vnet2.zip</a></li>
		    <li>vnet2 binary code (.jar file, 111 KB): <a href="vnet2.jar">vnet2.jar</a>. It includes a manifest file it is possible
			    to start the server using: <pre>java -jar vnet2.jar</pre></li>
		    <li>vnet2user binary code (.jar file, 11 KB): <a href="vnet2user.jar">vnet2user.jar</a></li>
		</ul>
		</p>
		<hr size="1" color="#333399">
		</td></tr></table>
		<table border="0"><tr><td width="5"></td><td>
		<a name="Example"><h2><font color="#333399">Example</font></h2></a>
		<p>To see the following example, it is required to download the <i>jar</i> files shown on the <a href="#LicenseAndDownload">previous section</a>, 
		plus the following 2 files:</p>
		<ul type="disc">
		    <li>A virtual net layout (text file): <a href="example.vnet">example.vnet</a></li>
		    <li>The example in binary format (.jar, 24 KB): <a href="counter.jar">counter.jar</a></li>
		</ul>
		</p>
		<p>You can download as well the source for the example (9 KB): <a href="counter.zip">counter.zip</a>.</p>
		<br>
		<ol>
		 <li><p>The first step is to start the virtual net server. This can be done with:
		<pre>java -jar vnet2.jar example.vnet</pre>
		This should show a netlayout like the shown before, with some nodes and links deactivated. This example uses
		the port <b>3456</b>.</p></li>
		<li><p>Now, the server of the example is started. Please introduce the next info (just one line), which
		contacts with the virtual net on the port <b>3456</b>, and simulates the server on the node <b>E</b>. An additional
		argument is given, with the name of the server (a file is written with this name containing the server's reference).<p></li>
<pre>java -classpath vnet2.jar:vnet2user.jar:counter.jar counter.Server</pre> 
<pre>  -virtualHostName E -virtualNetPort 3456 ServerExample</pre></li>
		<li><p>One or more clients can now be started. Please introduce the next info (just one line), which
		contacts with the virtual net on the port <b>3456</b>, and simulates the client on the node <b>A</b>. An additional
		argument is given, with the name of the server.<p></li>
<pre>java -classpath vnet2.jar:vnet2user.jar:counter.jar counter.Client</pre> 
<pre>  -virtualHostName A -virtualNetPort 3456 ServerExample</pre></li>
		</ol>
		<p>On the layout given, I have included long delays; for this reason, any request can take much longuer than expected.
		It is possible to see on the screen the events on the net; try to deactivate any node or link to check that the client
		receives indeed the appropiated exception. Note on the source code that no special adaptations have been added
		(only the already mentioned one-line setup).
		</td></tr></table>
	  </td>
    </tr>
</table>
</body>
</html>
